<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hireoscope - Create Job Title</title>
    <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <form th:action="@{/employer/postjob}" th:object="${jobDto}" method="post">
        <nav class="navbar sticky-top navbar-light bg-white p-3">
            <div class="container">
                <a class="navbar-brand fw-bold" th:href="@{/employer/home}">Hireoscope</a>
            </div>
        </nav>

        <!-- Step 1 -->
        <div class="container-box" id="step1">
            <input type="hidden" name="employerEmail" th:value="${email}" />
            <h2 class="text-center fw-bold mb-4">Step 1: Job Title</h2>
            <p class="text-center">Your title is the first thing candidates see. Make it compelling!</p>

            <div class="form-group">
                <input type="text" class="form-control custom-input" th:field="*{jobTitle}"
                    placeholder="E.g., AI Developer for Next-Gen Project">
            </div>

            <h5 class="mt-4 fw-bold">Examples to inspire you:</h5>
            <div class="example-box">Full-Stack Developer for High-Performance Web App</div>
            <div class="example-box">UI/UX Designer for Next-Level Mobile Experience</div>
            <div class="example-box">Cybersecurity Specialist for Risk Assessment & Compliance</div>
        </div>

        <!-- Step 2 -->
        <!-- Step 2: Updated Skills Section -->
        <div class="container-box hidden" id="step2">
            <h2>Step 2: Required Skills</h2>

            <!-- Skill input field -->
            <div class="form-group mb-3">
                <label for="skillInput">Add Skills</label>
                <input type="text" id="skillInput" class="form-control" placeholder="Type skill and press Enter">
            </div>

            <!-- Hidden field to store all selected skills -->
            <input type="hidden" th:field="*{requiredSkills}" id="skillsHiddenInput" />

            <!-- Selected Skills Display -->
            <div class="mb-3">
                <label>Selected Skills</label>
                <div class="selected-skills-box border p-2 rounded" id="selectedSkillsBox" style="min-height: 50px;">
                    <!-- Dynamically added skill tags will appear here -->
                </div>
            </div>

            <!-- Suggested/Popular Skills -->
            <h6 class="mt-3">Popular Skills</h6>
            <div class="skills-suggestions mb-2">
                <span class="badge bg-secondary me-2 skill-suggestion">JavaScript</span>
                <span class="badge bg-secondary me-2 skill-suggestion">React</span>
                <span class="badge bg-secondary me-2 skill-suggestion">Node.js</span>
                <span class="badge bg-secondary me-2 skill-suggestion">MongoDB</span>
                <span class="badge bg-secondary me-2 skill-suggestion">HTML5</span>
            </div>
        </div>


        <!-- Navigation -->
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
            <div class="nav-buttons">
                <button class="btn btn-outline-dark" id="backBtn" type="button"><i class="fas fa-arrow-left"></i>
                    Back</button>
                <button class="btn btn-dark" id="nextBtn" type="button">Next <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 3 -->
        <!-- Step 3: Job Details -->
        <div class="container-box hidden" id="step3">
            <h2>Step 3: Job Details</h2>

            <!-- Job Status (hidden as always "draft") -->
            <input type="hidden" th:field="*{jobStatus}" value="draft" readonly />

            <!-- Work Mode -->
            <div class="mb-4">
                <label class="form-label fw-bold">Work Mode</label>
                <div class="btn-group d-flex" role="group">
                    <input type="radio" class="btn-check" name="workMode" id="offline" value="offline"
                        th:field="*{workMode}" autocomplete="off">
                    <label class="btn btn-outline-primary" for="offline">Offline</label>

                    <input type="radio" class="btn-check" name="workMode" id="online" value="online"
                        th:field="*{workMode}" autocomplete="off">
                    <label class="btn btn-outline-primary" for="online">Online</label>

                    <input type="radio" class="btn-check" name="workMode" id="hybrid" value="hybrid"
                        th:field="*{workMode}" autocomplete="off">
                    <label class="btn btn-outline-primary" for="hybrid">Hybrid</label>
                </div>
            </div>

            <!-- Experience Level -->
            <div class="mb-4">
                <label class="form-label fw-bold">Experience Level</label>
                <div class="btn-group d-flex" role="group">
                    <input type="radio" class="btn-check" name="experience" id="entry" value="entry"
                        th:field="*{experience}" autocomplete="off">
                    <label class="btn btn-outline-success" for="entry">Entry</label>

                    <input type="radio" class="btn-check" name="experience" id="intermediate" value="intermediate"
                        th:field="*{experience}" autocomplete="off">
                    <label class="btn btn-outline-success" for="intermediate">Intermediate</label>

                    <input type="radio" class="btn-check" name="experience" id="expert" value="expert"
                        th:field="*{experience}" autocomplete="off">
                    <label class="btn btn-outline-success" for="expert">Expert</label>
                </div>
            </div>

            <!-- Location -->
            <div class="mb-4">
                <label class="form-label fw-bold">Job Location</label>
                <div id="locationContainer">
                    <div class="d-flex mb-2">
                        <input type="text" class="form-control me-2" placeholder="e.g., New York" th:field="*{location}"
                            id="locationInput" />
                        <button type="button" class="btn btn-outline-primary" id="addLocationBtn"><i
                                class="fas fa-plus"></i></button>
                    </div>
                </div>
                <small class="text-muted">Note: You can only add one location in this version.</small>
            </div>

            <!-- Education -->
            <div class="mb-4">
                <label class="form-label fw-bold">Minimum Qualification</label>
                <div id="qualificationContainer">
                    <div class="d-flex mb-2">
                        <input type="text" class="form-control me-2" placeholder="e.g., B.Tech, MCA"
                            th:field="*{eligibility}" id="qualificationInput" />
                        <button type="button" class="btn btn-outline-primary" id="addQualificationBtn"><i
                                class="fas fa-plus"></i></button>
                    </div>
                </div>
                <small class="text-muted">Only one qualification is allowed for now.</small>
            </div>
        </div>


        <!-- Step 4 -->
        <div class="container-box hidden" id="step4">
            <p class="text-muted">4/5 Job Post</p>
            <h2 class="text-center fw-bold mb-4">Set Your Budget</h2>

            <div class="mb-4">
                <label class="form-label fw-semibold">Minimum Salary: <span id="minSalaryDisplay">$15,000</span></label>
                <input type="range" min="0" max="100000" step="500" value="15000" id="minSalaryRange"
                    class="form-range">
                <input type="hidden" th:field="*{minSalary}" id="minSalary">
            </div>

            <div class="mb-4">
                <label class="form-label fw-semibold">Maximum Salary: <span id="maxSalaryDisplay">$25,000</span></label>
                <input type="range" min="0" max="200000" step="500" value="25000" id="maxSalaryRange"
                    class="form-range">
                <input type="hidden" th:field="*{maxSalary}" id="maxSalary">
            </div>

            <div class="text-muted mt-2">
                These values help candidates understand the expected compensation. You can adjust the range as needed.
            </div>
        </div>


        <!-- Step 5 -->
        <!-- Step 5: Final Details -->
        <div class="container-box hidden" id="step5">
            <p class="text-muted">5/5 Job Post</p>
            <h2 class="text-center fw-bold mb-4">Describe Your Opportunity</h2>

            <!-- Job Description -->
            <div class="mb-4">
                <label for="jobDescription" class="form-label fw-semibold">Job Description</label>
                <textarea th:field="*{jobDescription}" id="jobDescription" rows="6"
                    class="form-control border border-dark-subtle shadow-sm"
                    placeholder="Clearly explain responsibilities, required skills, and benefits..."></textarea>
                <div class="form-text">Give candidates a clear idea of the role and what you're looking for.</div>
            </div>

            <!-- Deadline -->
            <div class="mb-4">
                <label for="applicationDeadline" class="form-label fw-semibold">Application Deadline</label>
                <div class="input-group shadow-sm">
                    <span class="input-group-text bg-dark text-white">
                        <i class="fas fa-calendar-alt"></i>
                    </span>
                    <input type="date" th:field="*{applicationDeadline}" id="applicationDeadline"
                        class="form-control border border-dark-subtle" />
                </div>
                <div class="form-text">Pick a closing date to stop receiving new applications.</div>
                <input type="hidden" th:field="*{companyId}" value="${companyId}" />

            </div>

            <!-- Submit -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-lg btn-success px-5 shadow">
                    <i class="fas fa-paper-plane me-2"></i>Submit Job
                </button>
            </div>
        </div>

    </form>

    <!-- JavaScript -->
    <script th:src="@{/js/jobpost.js}"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const employerEmail = urlParams.get('email');
        if (employerEmail) {
            document.querySelector('input[name="employerEmail"]').value = employerEmail;
        }

        const skillInput = document.getElementById("skillInput");
        const skillsBox = document.getElementById("selectedSkillsBox");
        const skillsHidden = document.getElementById("skillsHiddenInput");

        let selectedSkills = [];

        // Add skill from input
        skillInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                e.preventDefault();
                const skill = skillInput.value.trim();
                if (skill && !selectedSkills.includes(skill.toLowerCase())) {
                    addSkill(skill);
                    skillInput.value = "";
                }
            }
        });

        // Add skill from suggested list
        document.querySelectorAll(".skill-suggestion").forEach(suggestion => {
            suggestion.addEventListener("click", () => {
                const skill = suggestion.textContent.trim();
                if (!selectedSkills.includes(skill.toLowerCase())) {
                    addSkill(skill);
                }
            });
        });

        // Add skill to UI and list
        function addSkill(skill) {
            selectedSkills.push(skill.toLowerCase());

            const tag = document.createElement("span");
            tag.className = "badge bg-primary me-2 mb-2 position-relative";
            tag.innerHTML = `
            ${skill}
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger remove-skill" style="cursor:pointer;">&times;</span>
        `;

            // Remove skill handler
            tag.querySelector(".remove-skill").addEventListener("click", () => {
                selectedSkills = selectedSkills.filter(s => s !== skill.toLowerCase());
                skillsBox.removeChild(tag);
                updateHiddenField();
            });

            skillsBox.appendChild(tag);
            updateHiddenField();
        }

        // Update hidden input value
        function updateHiddenField() {
            skillsHidden.value = selectedSkills.join(",");
        }

        // On form submit, make sure the latest value is set
        document.querySelector("form").addEventListener("submit", updateHiddenField);

        document.getElementById("addLocationBtn").addEventListener("click", () => {
            const input = document.getElementById("locationInput");
            if (input.value.trim()) {
                alert("Only one location supported in this version. You entered: " + input.value);
            }
        });

        document.getElementById("addQualificationBtn").addEventListener("click", () => {
            const input = document.getElementById("qualificationInput");
            if (input.value.trim()) {
                alert("Only one qualification supported in this version. You entered: " + input.value);
            }
        });

        const minSlider = document.getElementById("minSalaryRange");
        const maxSlider = document.getElementById("maxSalaryRange");
        const minDisplay = document.getElementById("minSalaryDisplay");
        const maxDisplay = document.getElementById("maxSalaryDisplay");
        const minInput = document.getElementById("minSalary");
        const maxInput = document.getElementById("maxSalary");

        function formatCurrency(value) {
            return `$${parseInt(value).toLocaleString()}`;
        }

        function updateSalaryValues() {
            const min = parseInt(minSlider.value);
            const max = parseInt(maxSlider.value);

            // prevent overlap
            if (min > max) {
                maxSlider.value = min;
            }

            minDisplay.textContent = formatCurrency(minSlider.value);
            maxDisplay.textContent = formatCurrency(maxSlider.value);

            minInput.value = minSlider.value;
            maxInput.value = maxSlider.value;
        }

        minSlider.addEventListener("input", updateSalaryValues);
        maxSlider.addEventListener("input", updateSalaryValues);

        document.addEventListener("DOMContentLoaded", updateSalaryValues);
    </script>
</body>

</html>
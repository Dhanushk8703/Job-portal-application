<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hireoscope - Create Job Title</title>
    <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <form th:action="@{/employer/postjob}" th:object="${jobDto}" method="post">
        <nav class="navbar sticky-top navbar-light bg-white p-3">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#">Hireoscope</a>
            </div>
        </nav>

        <div class="container-box" id="step1">
            <input type="hidden" name="employerEmail" th:value="${email}" />
            <p class="text-muted">1/5 Job Post</p>
            <h2 class="text-center fw-bold">Create an Impactful Job Title</h2>
            <p class="text-center">Your title is the first thing candidates see. Make it compelling!</p>

            <input type="text" class="custom-input" th:field="*{jobTitle}"
                placeholder="E.g., AI Developer for Next-Gen Project">

            <h5 class="mt-4 fw-bold">Examples to inspire you:</h5>
            <div class="example-box">Full-Stack Developer for High-Performance Web App</div>
            <div class="example-box">UI/UX Designer for Next-Level Mobile Experience</div>
            <div class="example-box">Cybersecurity Specialist for Risk Assessment & Compliance</div>
        </div>

        <div class="container-box hidden" id="step2">
            <p class="text-muted">2/5 Job Post</p>
            <h2>What are the main skills required for your work?</h2>
            <input type="text" class="custom-input" id="skillsInput" placeholder="Search skills or add your own">

            <input type="hidden" th:field="*{requiredSkills}" id="skills" />

            <h5 class="hidden" id="selectedSkillsHeading">Selected Skills</h5>
            <div class="selected-skills" id="selectedSkills"></div>

            <h5>Popular skills for Full Stack Development</h5>
            <div class="skills-container" id="skillsContainer">
                <span class="skill-badge">JavaScript</span>
                <span class="skill-badge">Node.js</span>
                <span class="skill-badge">MongoDB</span>
                <span class="skill-badge">React</span>
                <span class="skill-badge">HTML5</span>
            </div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
            <div class="nav-buttons">
                <button class="btn-custom btn-outline-dark" id="backBtn" type="button"><i class="fas fa-arrow-left"></i>
                    Back</button>
                <button class="btn-custom btn-dark" id="nextBtn" type="button">Next<i
                        class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <div class="container-box hidden" id="step3">
            <p class="text-muted">3/5 Job Post</p>
            <h2>Specify the job type and work mode.</h2>
            <div class="option-group" id="jobStatusSection">
                <div class="option"><input type="radio" th:field="*{jobStatus}" value="draft"> Draft</div>
            </div>
            <div class="option-group" id="workModeSection">
                <div class="option"><input type="radio" th:field="*{workMode}" value="Full Time"> Offline</div>
                <div class="option"><input type="radio" th:field="*{workMode}" value="Part Time"> Online</div>
            </div>
            <div class="option-group" id="experienceSection">
                <div class="option"><input type="radio" th:field="*{experience}" value="entry"> Entry</div>
                <div class="option"><input type="radio" th:field="*{experience}" value="intermediate"> Intermediate
                </div>
                <div class="option"><input type="radio" th:field="*{experience}" value="expert"> Expert</div>
            </div>
            <div id="jobLocationSection">
                <div id="jobLocationContainer">
                    <div class="location-input">
                        <input type="text" class="custom-input location-input-field" placeholder="Enter job location"
                            th:field="*{location}">
                        <button class="remove-btn" type="button"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addLocationBtn">+ Add Location</button>
                <button type="button" class="btn btn-success" id="saveLocationBtn">Save</button>
            </div>
            <div id="educationSection">
                <div id="educationContainer">
                    <div class="edu-input">
                        <input type="text" class="custom-input edu-input-field" placeholder="Enter qualification"
                            th:field="*{eligibility}">
                        <button class="remove-btn" type="button"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addEducationBtn">+ Add Qualification</button>
                <button type="button" class="btn btn-success" id="saveEducationBtn">Save</button>
            </div>
        </div>

        <div class="container-box hidden" id="step4">
            <p class="text-muted">4/5 Job Post</p>
            <div id="hourlyPriceForm">
                <input type="text" class="custom-input" placeholder="$15.00 / hr" th:field="*{minSalary}">
                <input type="text" class="custom-input" placeholder="$35.00 / hr" th:field="*{maxSalary}">
            </div>
            <p class="not-ready" onclick="skipBudget()">Not ready to set a budget?</p>
        </div>

        <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>
        <div id="budgetModal" class="modal">
            <span class="close-btn" onclick="closeModal()">âœ–</span>
            <h2>Set Your Budget</h2>
            <p>You're not committing to anything final. Setting a budget helps us match you with the right candidates.
            </p>
            <button class="btn-primary" onclick="closeModal()">Add Budget</button>
            <button class="btn-secondary" onclick="continueWithoutBudget()">Continue Without Budget</button>
        </div>

        <div class="container-box" id="step5">
            <p class="text-muted">5/5 Job Post</p>
            <textarea class="form-control" th:field="*{jobDescription}" placeholder="Type your job description here..."
                rows="5"></textarea>
            <input type="date" class="custom-input" th:field="*{applicationDeadline}">
            <button type="submit" class="btn btn-primary mt-3">Submit Job</button>
        </div>
    </form>
    <script th:src="@{/js/jobpost.js}"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const employerEmail = urlParams.get('email');
        if (employerEmail) {
            document.querySelector('input[name="employerEmail"]').value = employerEmail;
        }
        const selectedSkills = [];

        const input = document.getElementById("skillsInput");
        const skillsContainer = document.getElementById("skillsContainer");
        const selectedSkillsDiv = document.getElementById("selectedSkills");
        const selectedSkillsHeading = document.getElementById("selectedSkillsHeading");
        const hiddenInput = document.getElementById("skills");

        // Add skill from popular tags
        document.querySelectorAll(".skill-badge").forEach(skillBadge => {
            skillBadge.addEventListener("click", () => {
                const skill = skillBadge.textContent.trim();
                addSkill(skill);
            });
        });

        // Add skill from input field
        input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                const skill = input.value.trim();
                if (skill) {
                    addSkill(skill);
                    input.value = '';
                }
            }
        });

        function addSkill(skill) {
            if (!selectedSkills.includes(skill)) {
                selectedSkills.push(skill);
                updateSelectedSkills();
            }
        }

        function updateSelectedSkills() {
            selectedSkillsDiv.innerHTML = '';
            selectedSkillsHeading.classList.remove("hidden");

            selectedSkills.forEach(skill => {
                const span = document.createElement("span");
                span.className = "skill-badge";
                span.textContent = skill;
                selectedSkillsDiv.appendChild(span);
            });

            // Update the hidden input value
            hiddenInput.value = selectedSkills.join(", ");
        }

        // Ensure hidden input is populated before submit
        document.querySelector("form").addEventListener("submit", () => {
            hiddenInput.value = selectedSkills.join(", ");
        });
    </script>

</body>

</html>
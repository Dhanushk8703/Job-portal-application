<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Dashboard</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/employer_style.css}">
    <style>
        .content .nav-tabs {
            border-bottom: none;
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            border-radius: 10px;
        }

        .content .nav-tabs .nav-item .nav-link {
            border: none;
            color: #1a104f;
            font-size: 14px;
            padding: 10px 15px;
            transition: all 0.3s ease-in-out;
            border-radius: 8px;
            background: rgba(26, 16, 79, 0.1);
            font-weight: 500;
        }

        .content .nav-tabs .nav-item .nav-link.active {
            background: linear-gradient(135deg, #1a104f, #3a2f7a);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(26, 16, 79, 0.3);
        }

        .content .tab-content {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            animation: fadeIn 0.5s ease-in-out;
        }

        .content .nav-tabs .nav-item {
            list-style: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .job-card {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
            margin-bottom: 20px;
            border-left: 5px solid #1a104f;
        }

        .job-card:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .job-card .job-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #3a2f7a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .job-card .job-title {
            font-size: 18px;
            font-weight: bold;
            color: #1a104f;
            margin-bottom: 5px;
        }

        .job-card .job-description {
            font-size: 14px;
            color: #6c757d;
        }

        .job-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .job-actions button {
            background: linear-gradient(135deg, #6f42c1, #1a104f);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .job-actions button i {
            display: none;
        }

        .job-actions button:hover i {
            display: inline-block;
            opacity: 1;
            transform: translateX(0);
        }

        .job-actions .btn-outline-primary,
        .job-actions .btn-outline-success,
        .job-actions .btn-outline-danger {
            background: transparent;
            border: 2px solid #1a104f;
            color: #1a104f;
        }

        .job-actions .btn-outline-primary:hover,
        .job-actions .btn-outline-success:hover,
        .job-actions .btn-outline-danger:hover {
            background-color: #1a104f;
            color: white;
        }

        @media (max-width: 768px) {
            .job-card {
                flex-direction: column;
                text-align: center;
            }

            .job-actions {
                flex-direction: row;
                justify-content: center;
                flex-wrap: wrap;
            }

            .job-actions button {
                width: auto;
            }
        }

        .hidden {
            display: none;
        }

        .job-details {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-left: 4px solid #007bff;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div class="d-flex">
        <div class="sidebar d-lg-flex d-none">
            <ul class="nav-links">
                <li class="nav-item">
                    <a th:href="@{/employer/home}" class="nav-link" onclick="setActive(this)">
                        <i class="fa-solid fa-chart-line"></i><span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/employer/myjobs}" class="nav-link active" onclick="setActive(this)">
                        <i class="fa-solid fa-briefcase"></i><span>My Jobs</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a th:href="@{/employer/candidates}" class="nav-link" onclick="setActive(this)">
                        <i class="fa-solid fa-users"></i><span>Candidates</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="setActive(this)">
                        <i class="fa-solid fa-envelope"></i><span>Messages</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="setActive(this)">
                        <i class="fa-solid fa-calendar-check"></i><span>Schedules</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <div class="topbar d-flex justify-content-between p-3">
                <h4>Hireoscope</h4>
                <div>
                    <button class="btn btn-light" th:onclick="|window.location.href='@{/employer/postjob}'|">
                        <i class="fa-solid fa-plus"></i> <span>Post a Job</span>
                    </button>

                    <button class="btn btn-light" th:onclick="|window.location.href='@{/employer/profile}'|">
                        <i class="fa-solid fa-cog"></i> <span>Settings</span>
                    </button>

                    <button class="btn btn-light" th:onclick="|window.location.href='@{/logout}'|">
                        <i class="fa-solid fa-sign-out-alt"></i> <span>Log out</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="content container">
            <ul class="nav nav-tabs" id="jobTabs">
                <li class="nav-item">
                    <a class="nav-link active" id="draft-tab" data-bs-toggle="tab" href="#draft">Draft</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="posted-tab" data-bs-toggle="tab" href="#posted">Posted</a>
                </li>
            </ul>
            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="draft">
                    <div id="draftJobsContainer" class="job-list"></div>
                </div>
                <div class="tab-pane fade" id="posted">
                    <div id="postedJobsContainer" class="job-list"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="floating-menu d-lg-none" onclick="toggleMenu()">
        <i class="fa-solid fa-plus"></i>
        <div class="menu-item"><i class="fa-solid fa-users"></i></div>
        <div class="menu-item"><i class="fa-solid fa-user-clock"></i></div>
        <div class="menu-item"><i class="fa-solid fa-bell"></i></div>
        <div class="menu-item"><i class="fa-solid fa-calendar-days"></i></div>
        <div class="menu-item"><i class="fa-solid fa-cog"></i></div>
    </div>
    <div id="sessionData" th:attr="data-email=${session.email}" style="display: none;"></div>

    <script th:src="@{https://cdn.jsdelivr.net/npm/chart.js}"></script>
    <script th:src="@{/js/dashscript.js}"></script>
    <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js}"></script>
    <script>
        function toggleMenu() {
            let menu = document.querySelector(".floating-menu");
            let icon = menu.querySelector("i");

            menu.classList.toggle("open");

            if (menu.classList.contains("open")) {
                icon.classList.remove("fa-plus");
                icon.classList.add("fa-times"); // Change to "Ã—" icon
            } else {
                icon.classList.remove("fa-times");
                icon.classList.add("fa-plus"); // Revert back to "+"
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            // sessionStorage.setItem("employerEmail", /*[[${email}]]*/ '');

            // const employerEmail = sessionStorage.getItem("employerEmail");
            // console.log("Employer Email:", employerEmail);

            const employerEmail = document.getElementById('sessionData').dataset.email;
            console.log("Email from session:", employerEmail);
            if (!employerEmail) return;

            const token = sessionStorage.getItem("jwtToken");
            console.log("Token from session:", token);

            const apiBaseUrl = "http://localhost:9090";

            fetch(`${apiBaseUrl}/employer/api/drafts?employerEmail=${employerEmail}`, {
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            })
                .then(res => res.json())
                .then(jobs => {
                    const container = document.getElementById("draftJobsContainer");
                    container.innerHTML = "";

                    if (jobs.length === 0) {
                        container.innerHTML = `<p class="text-muted">No draft jobs found.</p>`;
                        return;
                    }

                    jobs.forEach((job, index) => {
                        const card = document.createElement("div");
                        card.className = "job-card";
                        card.innerHTML = `
                    <div class="job-icon"><i class="fa-solid fa-briefcase"></i></div>
                    <div>
                        <div class="job-title">${job.jobTitle}</div>
                        <div class="job-description">${job.jobDescription || "Draft job post - Add details to your draft"}</div>
                    </div>
                    <div class="job-actions">
                        <button class="btn btn-outline-primary" onclick="toggleDetails('details${index}')">
                            <i class="fa-solid fa-eye"></i> View Details
                        </button>
                        <button class="btn btn-outline-success" onclick="postJob(${job.id})">
                            <i class="fa-solid fa-paper-plane"></i> Post Job
                        </button>
                        <button class="btn btn-outline-danger" onclick="deleteDraft(${job.id})">
                            <i class="fa-solid fa-trash"></i> Remove Draft
                        </button>
                    </div>
                    <div class="job-details hidden mt-3 p-3 border rounded bg-light" id="details${index}">
                        <p><strong>Job ID:</strong> ${job.id}</p>
                        <p><strong>Job Title:</strong> ${job.jobTitle}</p>
                        <p><strong>Description:</strong> ${job.jobDescription}</p>
                        <p><strong>Location:</strong> ${job.location}</p>
                        <p><strong>Work Mode:</strong> ${job.workMode}</p>
                        <p><strong>Eligibility:</strong> ${job.eligibility}</p>
                        <p><strong>Required Skills:</strong> ${job.requiredSkills}</p>
                        <p><strong>Experience Level:</strong> ${job.experience}</p>
                        <p><strong>Status:</strong> ${job.jobStatus}</p>
                        <p><strong>Salary Range:</strong> $${job.minSalary} - $${job.maxSalary}</p>
                        <p><strong>Deadline:</strong> ${job.applicationDeadline}</p>
                    </div>
                `;
                        container.appendChild(card);
                    });
                })
                .catch(err => {
                    console.error("Error fetching draft jobs:", err);
                    const container = document.getElementById("draftJobsContainer");
                    container.innerHTML = `<p class="text-danger">Failed to load draft jobs.</p>`;
                });
        });

        // Toggle detail section
        function toggleDetails(id) {
            const detailDiv = document.getElementById(id);
            detailDiv.classList.toggle("hidden");
        }

        // Post a job
        function postJob(id) {
            console.log("Posting job with ID:", id);
            const apiBaseUrl = "http://localhost:9090";
            const token = sessionStorage.getItem("jwtToken");
            fetch(`${apiBaseUrl}/employer/api/post/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            })
                .then(res => {
                    if (!res.ok) throw new Error("Failed to post job");
                    return res.json();
                })
                .then(updatedJob => {
                    alert("Job posted successfully!");
                    location.reload();
                })
                .catch(err => {
                    alert("Error posting job.");
                    console.error(err);
                });
        }

        // Delete a draft
        function deleteDraft(id) {
            const apiBaseUrl = "http://localhost:9090";
            const token = sessionStorage.getItem("jwtToken");
            if (confirm("Are you sure you want to delete this draft?")) {
                fetch(`${apiBaseUrl}/employer/api/delete/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                })
                    .then(res => res.text())
                    .then(msg => {
                        alert(msg);
                        location.reload();
                    })
                    .catch(err => {
                        alert("Error deleting draft.");
                        console.error(err);
                    });
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            // sessionStorage.setItem("employerEmail", /*[[${email}]]*/ '');

            // const employerEmail = sessionStorage.getItem("employerEmail");
            // console.log("Employer Email:", employerEmail);

            const employerEmail = document.getElementById('sessionData').dataset.email;
            console.log("Email from session:", employerEmail);
            if (!employerEmail) return;

            const token = sessionStorage.getItem("jwtToken");
            console.log("Token from session:", token);

            const apiBaseUrl = "http://localhost:9090";

            fetch(`${apiBaseUrl}/employer/api/posted?employerEmail=${employerEmail}`, {
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            })
                .then(res => res.json())
                .then(jobs => {
                    const container = document.getElementById("postedJobsContainer");
                    container.innerHTML = "";

                    if (jobs.length === 0) {
                        container.innerHTML = `<p class="text-muted">No draft jobs found.</p>`;
                        return;
                    }

                    jobs.forEach((job, index) => {
                        const card = document.createElement("div");
                        card.className = "job-card";
                        card.innerHTML = `
                    <div class="job-icon"><i class="fa-solid fa-briefcase"></i></div>
                    <div>
                        <div class="job-title">${job.jobTitle}</div>
                        <div class="job-description">${job.jobDescription || "Draft job post - Add details to your draft"}</div>
                    </div>
                    <div class="job-actions">
                        <button class="btn btn-outline-primary" onclick="toggleDetails('details${index}')">
                            <i class="fa-solid fa-eye"></i> View Details
                        </button>
                        <button class="btn btn-outline-danger" onclick="deleteDraft(${job.id})">
                            <i class="fa-solid fa-trash"></i> Remove Job
                        </button>
                    </div>
                    <div class="job-details hidden mt-3 p-3 border rounded bg-light" id="details${index}">
                        <p><strong>Job ID:</strong> ${job.id}</p>
                        <p><strong>Job Title:</strong> ${job.jobTitle}</p>
                        <p><strong>Description:</strong> ${job.jobDescription}</p>
                        <p><strong>Location:</strong> ${job.location}</p>
                        <p><strong>Work Mode:</strong> ${job.workMode}</p>
                        <p><strong>Eligibility:</strong> ${job.eligibility}</p>
                        <p><strong>Required Skills:</strong> ${job.requiredSkills}</p>
                        <p><strong>Experience Level:</strong> ${job.experience}</p>
                        <p><strong>Status:</strong> ${job.jobStatus}</p>
                        <p><strong>Salary Range:</strong> $${job.minSalary} - $${job.maxSalary}</p>
                        <p><strong>Deadline:</strong> ${job.applicationDeadline}</p>
                    </div>
                `;
                        container.appendChild(card);
                    });
                })
                .catch(err => {
                    console.error("Error fetching draft jobs:", err);
                    const container = document.getElementById("postedJobsContainer");
                    container.innerHTML = `<p class="text-danger">Failed to load draft jobs.</p>`;
                });
        });
    </script>
</body>

</html>